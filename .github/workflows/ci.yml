name: CI Docker Compose

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Set up Postgres
        run: |
          docker image build -f ./database/Dockerfile -t test-postgres:latest ./database
          docker container run -d --rm -p 5432:5432 -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres --name test-progress test-postgres:latest        
      - name: Docker Compose API
        run: |
          docker-compose -f ./docker-compose3.yml up -d --build
      # - uses: isbang/compose-action@v1.5.1
      #   with:
      #     compose-file: "./docker-compose3.yml"
      #   env:
      #     DB_USER: postgres 
      #     DB_PASSWORD: postgres
      #     DB_NAME: postgres

      - name: List Docker images
        run: docker image ls
      - name: List Docker containers
        run: docker ps -a
      - name: Run tests
        run: curl localhost:8080/tasks